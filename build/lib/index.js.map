{"version":3,"sources":["../../src/lib/index.js"],"names":[],"mappings":"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","file":"lib/index.js","sourcesContent":["import mismatch from 'mismatch'\nimport { askSingle } from 'reloquent'\nimport { c } from 'erte'\n\nexport const extractOptions = (body) => {\n  const res = mismatch(\n    /<option value=\"(\\d+-phone)\">(.+?(\\d\\d\\d))<\\/option>/g,\n    body,\n    ['value', 'title', 'last']\n  )\n  return res\n}\n\nexport const extractFormState = (body) => {\n  const res = mismatch(\n    /<input type=\"hidden\" name=\"(.+?)\" id=\"__\\w+\" value=\"(.*?)\" \\/>/g,\n    body,\n    ['name', 'value'],\n  )\n  const r = res.reduce((acc, { name, value }) => {\n    return {\n      ...acc,\n      [name]: value,\n    }\n  }, {})\n  return r\n}\n\nconst mapPhoneOptions = o => {\n  const r = /(.+?)(\\d\\d\\d)$/.exec(o)\n  if (!r) return o\n  const [, g, n] = r\n  const gr = c(g, 'grey')\n  const co = `${gr}${n}`\n  return co\n}\n\nconst getColorOptions = (options) => {\n  const n = options\n    .map(({ title }) => ` ${title}`)\n    .map(mapPhoneOptions)\n    .join('\\n')\n  return n\n}\n\nexport const askForNumber = async (options, phone) => {\n  const s = getColorOptions(options)\n  const text = `Which phone number to use for 2 factor auth\n${s}\nenter last 3 digits`\n\n  const answer = await askSingle({\n    text,\n    async getDefault() {\n      return phone || options[0].last\n    },\n    validation(a) {\n      const p = options.some(({ last }) => last == a)\n      if (!p) {\n        throw new Error('Unknown number entered.')\n      }\n    },\n  })\n\n  const { value } = options.find(({ last }) => last == answer)\n  return value\n}\n\n\nexport const extractXsrf = (body) => {\n  const re = /<input type=\"hidden\" id=\"x-ncpl-csrfvalue\" value=\"(.+?)\"/\n  const res = re.exec(body)\n  if (!res) throw new Error('Could not find the x-ncpl-csrfvalue token on the page.')\n  const [, token] = res\n  return token\n}\n\n/**\n * Single level deep equal.\n */\nexport const deepEqual = (o1, o2) => {\n  const r = Object.keys(o1).reduce((acc, key) => {\n    const val = o1[key]\n    const val2 = o2[key]\n    if (!(key in o2)) {\n      const k = `-  ${key}`\n      const s = c(`${k}: ${val}`, 'red')\n      return [...acc, s]\n    } else if (val !== val2) {\n      const k = `-  ${key}`\n      const k2 = `+  ${key}`\n      const s = c(`${k}: ${val}`, 'red')\n      const s2 = c(`${k2}: ${val2}`, 'green')\n      return [...acc, s, s2]\n    }\n    return acc\n  }, [])\n  const r2 = Object.keys(o2).reduce((acc, key) => {\n    const val = o1[key]\n    if (!(key in o1)) {\n      const k = `+  ${key}`\n      const s = c(`${k}: ${val}`, 'green')\n      return [...acc, s]\n    }\n    return acc\n  }, r)\n  if (r2.length) {\n    const m = `\n{\n${r2.join('\\n')}\n}`.trim()\n    throw new Error(m)\n  }\n}"]}